const jwt  = require('jsonwebtoken');
const path = require('path');
const fs   = require('fs');

module.exports = {
	sign(data, privkey, kid) {
		return jwt.sign(data, privkey, {
			algorithm: 'RS256',
			header: { kid: kid }
		});
	},
	async verify(token, pubkey) {
		return new Promise(async (resolve, reject) => {
			try {
				return resolve(jwt.verify(token, pubkey, { algorithm: 'RS256' }));
			} catch (e) {
				reject(e);
			}
		});
	},
	async getKey(token) {
		return new Promise(async (resolve, reject) => {
			try {
				keyId = jwt.decode(token, { complete: true }).header.kid;
				keyFile = path.join(__dirname, '/../private', keyId);
				return resolve(fs.readFileSync(keyFile, 'utf8'));
			} catch (e) {
				reject(e);
			}
		});
	}
};